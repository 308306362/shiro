<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">

<!--
  - Application context definition global to all servlet configurations.
  -->
<beans>

    <!-- =========================================================
      -  JSecurity configuration
      ============================================================ -->
    <!-- JSecurity post processor that automatically invokes init() and destroy() methods for
         Spring-configured JSecurity objects so you don't have to 1) specify an init-method and destroy-method 
         attributes for every bean definition and 2) even know which JSecurity objects require these methods to be
         called. -->
    <bean class="org.jsecurity.spring.LifecycleBeanPostProcessor"/>

    <bean id="dataSource" class="org.springframework.jdbc.datasource.DriverManagerDataSource">
        <property name="driverClassName" value="org.hsqldb.jdbcDriver"/>
        <property name="url" value="jdbc:hsqldb:mem:jsecurity-spring"/>
        <property name="username" value="sa"/>
    </bean>
    <bean id="bootstrapDataPopulator" class="org.jsecurity.samples.spring.BootstrapDataPopulator">
        <property name="dataSource" ref="dataSource"/>
    </bean>

    <bean id="realm" class="org.jsecurity.realm.support.jdbc.JdbcRealm">
        <property name="dataSource" ref="dataSource"/>
        <property name="credentialMatcher">
            <bean class="org.jsecurity.authc.credential.commonsdigest.ShaCredentialMatcher">
                <property name="base64Encoded" value="true"/>
            </bean>
        </property>
    </bean>

    <!-- JSecurity's main business-tier object:  -->
    <bean id="securityManager" class="org.jsecurity.DefaultSecurityManager">
        <property name="realm" ref="realm"/>
    </bean>


    <!-- Enable JSecurity Annotations for Spring-configured beans: -->
    <bean class="org.springframework.aop.framework.autoproxy.DefaultAdvisorAutoProxyCreator"/>
    <bean class="org.jsecurity.spring.security.interceptor.AuthorizationAttributeSourceAdvisor"/>

    <!-- Ensure any Spring-based remote method invocations can be associated with a SecurityContext and a Session -->
    <bean id="secureRemoteInvocationExecutor" class="org.jsecurity.spring.remoting.SecureRemoteInvocationExecutor">
        <property name="securityManager" ref="securityManager"/>
    </bean>


    <!-- Web Interceptors -->
    <bean id="securityContextInterceptor" class="org.jsecurity.spring.servlet.security.SecurityContextInterceptor">
        <property name="securityManager" ref="securityManager"/>
    </bean>

    <bean id="authenticationInterceptor" class="org.jsecurity.spring.servlet.security.AuthenticationInterceptor">
        <property name="contextRelative" value="true"/>
        <property name="redirectUrl" value="/s/login"/>
    </bean>

    <bean id="sessionInterceptor" class="org.jsecurity.spring.servlet.security.SessionInterceptor">
        <property name="sessionFactory" ref="securityManager"/>
    </bean>


    <!-- Sample application-level business Managers -->
    <bean id="sampleManager" class="org.jsecurity.samples.spring.DefaultSampleManager"/>

</beans>
